'use strict';

angular.module('ahotelApp', ['ui.router']);
'use strict';

angular.module('ahotelApp').factory('PreloadImages', function () {
	"use strict";

	function PreloadImages(imageList) {
		this._imageSrcList = imageList;

		function preLoad(imageList) {

			var promises = [];

			function loadImage(src) {
				return new Promise(function (resolve, reject) {
					var image = new Image();
					image.src = src;
					image.onload = function () {
						console.log("loaded image: " + src);
						resolve(image);
					};
					image.onerror = function (e) {
						reject(e);
					};
				});
			}

			for (var i = 0; i < imageList.length; i++) {
				promises.push(loadImage(imageList[i]));
			}

			return Promise.all(promises).then(function (results) {
				console.log('promises array all resolved');
				console.dir(results);
				return results;
			});
		}

		preLoad(this._imageSrcList);
	}

	return PreloadImages;
});

/*
//hmm... Ang1.3.x+
angular.module('ahotelApp')
	.factory('PreloadImages', ['$q', function() {
		"use strict";

		function PreloadImages(imageList) {
			this._imageSrcList = imageList;

			function preLoad(imageList) {

				var promises = [];

				function loadImage(src) {
					return $q(function (resolve, reject) {
						var image = new Image();
						image.src = src;
						image.onload = function () {
							console.log("loaded image: " + src);
							resolve(image);
						};
						image.onerror = function (e) {
							reject(e);
						};
					})
				}

				for (let i = 0; i < imageList.length; i++) {
					promises.push(loadImage(imageList[i]));
				}

				return $q(promises).then(function (results) {
					console.log('promises array all resolved');
					console.dir(results);
					return results;
				});
			}

			preLoad(this._imageSrcList);
		}

		return PreloadImages
	}]);*/
'use strict';

angular.module('ahotelApp').config(["$stateProvider", "$urlRouterProvider", function ($stateProvider, $urlRouterProvider) {
	'use strict';

	$urlRouterProvider.otherwise('/');

	$stateProvider.state('template', {
		url: '/template',
		templateUrl: 'templates/template.html'
	});
}]);
'use strict';

angular.module('ahotelApp').directive('ahtlHeader', function () {
	"use strict";

	return {
		restrict: "EAC",
		templateUrl: 'app/templates/header/header.html'
	};
});
'use strict';

angular.module('ahotelApp').service('HeaderTransitionsService', ['$timeout', function ($timeout) {
	"use strict";

	function UItransitions(containerQuery) {
		//todo errors
		this.container = $(containerQuery);
	}

	UItransitions.prototype.elementTransition = function (targetElementsQuery, _ref) {
		var _ref$cssEnumerableRul = _ref.cssEnumerableRule,
		    cssEnumerableRule = _ref$cssEnumerableRul === undefined ? 'width' : _ref$cssEnumerableRul,
		    _ref$from = _ref.from,
		    from = _ref$from === undefined ? 0 : _ref$from,
		    _ref$to = _ref.to,
		    to = _ref$to === undefined ? 'auto' : _ref$to,
		    _ref$delay = _ref.delay,
		    delay = _ref$delay === undefined ? 100 : _ref$delay;

		//todo errors
		this.container.mouseenter(function () {
			var targetElements = $(this).find(targetElementsQuery),
			    targetElementsFinishState;

			targetElements.css(cssEnumerableRule, to);
			targetElementsFinishState = targetElements.css(cssEnumerableRule);
			targetElements.css(cssEnumerableRule, from);

			var animateOptions = {};
			animateOptions[cssEnumerableRule] = targetElementsFinishState;

			targetElements.animate(animateOptions, delay);
		});
	};

	function HeaderTransitions(headerQuery, containerQuery) {
		this.header = $(headerQuery);
		UItransitions.call(this, containerQuery);
	}

	HeaderTransitions.prototype = Object.create(UItransitions.prototype);
	HeaderTransitions.prototype.constructor = HeaderTransitions;

	HeaderTransitions.prototype.fixHeaderElement = function (_fixElement, fixClassName, unfixClassName, options) {
		var self = this;
		var fixElement = $(_fixElement);

		function onWidthChangeHandler() {
			var timer = void 0;

			function fixUnfixMenuOnScroll() {
				if ($(window).scrollTop() > options.onMinScrolltop) {
					fixElement.addClass(fixClassName);
				} else {
					fixElement.removeClass(fixClassName);
				}

				timer = null;
			}

			if ($(window).width() < options.onMaxWindowWidth) {
				fixUnfixMenuOnScroll();
				self.header.addClass(unfixClassName);

				$(window).off("scroll");
				$(window).scroll(function () {
					if (!timer) {
						timer = $timeout(fixUnfixMenuOnScroll, 150);
					}
				});
			} else {
				self.header.removeClass(unfixClassName);
				fixElement.removeClass(fixClassName);
				$(window).off("scroll");
			}
		}

		onWidthChangeHandler();
		$(window).on('resize', onWidthChangeHandler);
	};

	return HeaderTransitions;
}]);
'use strict';

angular.module('ahotelApp').directive('ahtlStikyHeader', ['HeaderTransitionsService', function (HeaderTransitionsService) {
	"use strict";

	function link() {
		var header = new HeaderTransitionsService('.l-header', '.nav__item-container');

		header.elementTransition('.sub-nav', {
			cssEnumerableRule: 'height',
			delay: 300
		});

		header.fixHeaderElement('.nav', 'js_nav--fixed', 'js_l-header--relative', {
			onMinScrolltop: 88,
			onMaxWindowWidth: 850
		});
	}

	return {
		restrict: "A",
		scope: {},
		link: link
	};
}]);
'use strict';

angular.module('ahotelApp').directive('ahtlSlider', ['SliderService', function (SliderService) {
	"use strict";

	function ahtlSliderController() {
		var imageList = ['assets/images/slider/slider1.jpg', 'assets/images/slider/slider2.jpg', 'assets/images/slider/slider3.jpg'];

		this.slider = new SliderService(imageList);
	}

	return {
		restrict: 'EA',
		scope: {},
		controller: ahtlSliderController,
		controllerAs: 'slider',
		templateUrl: 'app/templates/header/slider/slider.html'
	};
}]);
'use strict';

angular.module('ahotelApp').service('SliderService', ['PreloadImages', function (PreloadImages) {
			"use strict";

			function Slider(sliderImageList) {
						PreloadImages.call(this, sliderImageList);
						this._currentSlideSrc = 0;
			}

			Slider.prototype = Object.create(PreloadImages.prototype);
			Slider.prototype.constructor = Slider;

			Slider.prototype.getCurrentSlide = function () {
						return this._imageSrcList[this._currentSlideSrc];
			};

			Slider.prototype.getNextSlide = function () {
						this._currentSlideSrc === this._imageSrcList.length ? this._currentSlideSrc = 0 : this._currentSlideSrc++;

						this.getCurrentSlide();
			};

			Slider.prototype.getPrevSlide = function () {
						this._currentSlideSrc === 0 ? this._currentSlideSrc = this._imageSrcList.length - 1 : this._currentSlideSrc--;

						this.getCurrentSlide();
			};

			return Slider;
}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsInByZWxvYWRJbWdTZXJ2aWNlLmpzIiwicm91dGVzLmpzIiwidGVtcGxhdGVzL2hlYWRlci9oZWFkZXJEaXJlY3RpdmUuanMiLCJ0ZW1wbGF0ZXMvaGVhZGVyL2hlYWRlclRyYW5zaXRpb25zU2VydmljZS5qcyIsInRlbXBsYXRlcy9oZWFkZXIvc3Rpa3lIZWFkZXJEaXJlY3RpdmUuanMiLCJ0ZW1wbGF0ZXMvaGVhZGVyL3NsaWRlci9zbGlkZXIuZGlyZWN0aXZlLmpzIiwidGVtcGxhdGVzL2hlYWRlci9zbGlkZXIvc2xpZGVyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZmFjdG9yeSIsIlByZWxvYWRJbWFnZXMiLCJpbWFnZUxpc3QiLCJfaW1hZ2VTcmNMaXN0IiwicHJlTG9hZCIsInByb21pc2VzIiwibG9hZEltYWdlIiwic3JjIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJpbWFnZSIsIkltYWdlIiwib25sb2FkIiwiY29uc29sZSIsImxvZyIsIm9uZXJyb3IiLCJlIiwiaSIsImxlbmd0aCIsInB1c2giLCJhbGwiLCJ0aGVuIiwicmVzdWx0cyIsImRpciIsImNvbmZpZyIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImRpcmVjdGl2ZSIsInJlc3RyaWN0Iiwic2VydmljZSIsIiR0aW1lb3V0IiwiVUl0cmFuc2l0aW9ucyIsImNvbnRhaW5lclF1ZXJ5IiwiY29udGFpbmVyIiwiJCIsInByb3RvdHlwZSIsImVsZW1lbnRUcmFuc2l0aW9uIiwidGFyZ2V0RWxlbWVudHNRdWVyeSIsImNzc0VudW1lcmFibGVSdWxlIiwiZnJvbSIsInRvIiwiZGVsYXkiLCJtb3VzZWVudGVyIiwidGFyZ2V0RWxlbWVudHMiLCJmaW5kIiwidGFyZ2V0RWxlbWVudHNGaW5pc2hTdGF0ZSIsImNzcyIsImFuaW1hdGVPcHRpb25zIiwiYW5pbWF0ZSIsIkhlYWRlclRyYW5zaXRpb25zIiwiaGVhZGVyUXVlcnkiLCJoZWFkZXIiLCJjYWxsIiwiT2JqZWN0IiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJmaXhIZWFkZXJFbGVtZW50IiwiX2ZpeEVsZW1lbnQiLCJmaXhDbGFzc05hbWUiLCJ1bmZpeENsYXNzTmFtZSIsIm9wdGlvbnMiLCJzZWxmIiwiZml4RWxlbWVudCIsIm9uV2lkdGhDaGFuZ2VIYW5kbGVyIiwidGltZXIiLCJmaXhVbmZpeE1lbnVPblNjcm9sbCIsIndpbmRvdyIsInNjcm9sbFRvcCIsIm9uTWluU2Nyb2xsdG9wIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIndpZHRoIiwib25NYXhXaW5kb3dXaWR0aCIsIm9mZiIsInNjcm9sbCIsIm9uIiwiSGVhZGVyVHJhbnNpdGlvbnNTZXJ2aWNlIiwibGluayIsInNjb3BlIiwiU2xpZGVyU2VydmljZSIsImFodGxTbGlkZXJDb250cm9sbGVyIiwic2xpZGVyIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIlNsaWRlciIsInNsaWRlckltYWdlTGlzdCIsIl9jdXJyZW50U2xpZGVTcmMiLCJnZXRDdXJyZW50U2xpZGUiLCJnZXROZXh0U2xpZGUiLCJnZXRQcmV2U2xpZGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUFBQSxRQUFRQyxPQUFPLGFBQWEsQ0FBQyxjQUE3QjtBQ0FBOztBQUFBRCxRQUFRQyxPQUFPLGFBQ2JDLFFBQVEsaUJBQWlCLFlBQVc7Q0FDcEM7O0NBRUEsU0FBU0MsY0FBY0MsV0FBVztFQUNqQyxLQUFLQyxnQkFBZ0JEOztFQUVyQixTQUFTRSxRQUFRRixXQUFXOztHQUUzQixJQUFJRyxXQUFXOztHQUVmLFNBQVNDLFVBQVVDLEtBQUs7SUFDdkIsT0FBTyxJQUFJQyxRQUFRLFVBQVVDLFNBQVNDLFFBQVE7S0FDN0MsSUFBSUMsUUFBUSxJQUFJQztLQUNoQkQsTUFBTUosTUFBTUE7S0FDWkksTUFBTUUsU0FBUyxZQUFZO01BQzFCQyxRQUFRQyxJQUFJ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QUM3QyxPQUFPLEtBQUt6RixjQUFjLEtBQUt3Rjs7O0dBR2hDRixPQUFPakQsVUFBVXFELGVBQWUsWUFBVztNQUN6QyxLQUFLRixxQkFBcUIsS0FBS3hGLGNBQWNnQixTQUFVLEtBQUt3RSxtQkFBbUIsSUFBSSxLQUFLQTs7TUFFekYsS0FBS0M7OztHQUdOSCxPQUFPakQsVUFBVXNELGVBQWUsWUFBVztNQUN6QyxLQUFLSCxxQkFBcUIsSUFBSyxLQUFLQSxtQkFBbUIsS0FBS3hGLGNBQWNnQixTQUFTLElBQUksS0FBS3dFOztNQUU3RixLQUFLQzs7O0dBR04sT0FBT0g7SUE1QlYiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2Fob3RlbEFwcCcsIFsndWkucm91dGVyJ10pOyIsImFuZ3VsYXIubW9kdWxlKCdhaG90ZWxBcHAnKVxyXG5cdC5mYWN0b3J5KCdQcmVsb2FkSW1hZ2VzJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcInVzZSBzdHJpY3RcIjtcclxuXHJcblx0XHRmdW5jdGlvbiBQcmVsb2FkSW1hZ2VzKGltYWdlTGlzdCkge1xyXG5cdFx0XHR0aGlzLl9pbWFnZVNyY0xpc3QgPSBpbWFnZUxpc3Q7XHJcblxyXG5cdFx0XHRmdW5jdGlvbiBwcmVMb2FkKGltYWdlTGlzdCkge1xyXG5cclxuXHRcdFx0XHR2YXIgcHJvbWlzZXMgPSBbXTtcclxuXHJcblx0XHRcdFx0ZnVuY3Rpb24gbG9hZEltYWdlKHNyYykge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGltYWdlID0gbmV3IEltYWdlKCk7XHJcblx0XHRcdFx0XHRcdGltYWdlLnNyYyA9IHNyYztcclxuXHRcdFx0XHRcdFx0aW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwibG9hZGVkIGltYWdlOiBcIiArIHNyYyk7XHJcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZShpbWFnZSk7XHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRcdGltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xyXG5cdFx0XHRcdFx0XHRcdHJlamVjdChlKTtcclxuXHRcdFx0XHRcdFx0fTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlTGlzdC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoaW1hZ2VMaXN0W2ldKSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdwcm9taXNlcyBhcnJheSBhbGwgcmVzb2x2ZWQnKTtcclxuXHRcdFx0XHRcdGNvbnNvbGUuZGlyKHJlc3VsdHMpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHByZUxvYWQodGhpcy5faW1hZ2VTcmNMaXN0KTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gUHJlbG9hZEltYWdlc1xyXG5cdH0pO1xyXG5cclxuLypcclxuLy9obW0uLi4gQW5nMS4zLngrXHJcbmFuZ3VsYXIubW9kdWxlKCdhaG90ZWxBcHAnKVxyXG5cdC5mYWN0b3J5KCdQcmVsb2FkSW1hZ2VzJywgWyckcScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5cdFx0ZnVuY3Rpb24gUHJlbG9hZEltYWdlcyhpbWFnZUxpc3QpIHtcclxuXHRcdFx0dGhpcy5faW1hZ2VTcmNMaXN0ID0gaW1hZ2VMaXN0O1xyXG5cclxuXHRcdFx0ZnVuY3Rpb24gcHJlTG9hZChpbWFnZUxpc3QpIHtcclxuXHJcblx0XHRcdFx0dmFyIHByb21pc2VzID0gW107XHJcblxyXG5cdFx0XHRcdGZ1bmN0aW9uIGxvYWRJbWFnZShzcmMpIHtcclxuXHRcdFx0XHRcdHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHRcdFx0XHRcdHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG5cdFx0XHRcdFx0XHRpbWFnZS5zcmMgPSBzcmM7XHJcblx0XHRcdFx0XHRcdGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcImxvYWRlZCBpbWFnZTogXCIgKyBzcmMpO1xyXG5cdFx0XHRcdFx0XHRcdHJlc29sdmUoaW1hZ2UpO1xyXG5cdFx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0XHRpbWFnZS5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0XHRcdFx0XHRyZWplY3QoZSk7XHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZUxpc3QubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdHByb21pc2VzLnB1c2gobG9hZEltYWdlKGltYWdlTGlzdFtpXSkpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0cmV0dXJuICRxKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZygncHJvbWlzZXMgYXJyYXkgYWxsIHJlc29sdmVkJyk7XHJcblx0XHRcdFx0XHRjb25zb2xlLmRpcihyZXN1bHRzKTtcclxuXHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwcmVMb2FkKHRoaXMuX2ltYWdlU3JjTGlzdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIFByZWxvYWRJbWFnZXNcclxuXHR9XSk7Ki9cclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2Fob3RlbEFwcCcpXHJcblxyXG5cdC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIixcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcblx0XHQndXNlIHN0cmljdCc7XHJcblxyXG5cdFx0JHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xyXG5cclxuXHRcdCRzdGF0ZVByb3ZpZGVyXHJcblx0XHRcdC5zdGF0ZSgndGVtcGxhdGUnLCB7XHJcblx0XHRcdFx0dXJsOiAnL3RlbXBsYXRlJyxcclxuXHRcdFx0XHR0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy90ZW1wbGF0ZS5odG1sJ1xyXG5cdFx0XHR9KVxyXG5cdH1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnYWhvdGVsQXBwJylcclxuXHJcblx0LmRpcmVjdGl2ZSgnYWh0bEhlYWRlcicsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzdHJpY3Q6IFwiRUFDXCIsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnYXBwL3RlbXBsYXRlcy9oZWFkZXIvaGVhZGVyLmh0bWwnXHJcblx0XHR9XHJcblx0fSk7IiwiYW5ndWxhci5tb2R1bGUoJ2Fob3RlbEFwcCcpXHJcblxyXG5cdC5zZXJ2aWNlKCdIZWFkZXJUcmFuc2l0aW9uc1NlcnZpY2UnLCBbJyR0aW1lb3V0JywgZnVuY3Rpb24oJHRpbWVvdXQpIHtcclxuXHRcdFwidXNlIHN0cmljdFwiO1xyXG5cdFx0XHRmdW5jdGlvbiBVSXRyYW5zaXRpb25zKGNvbnRhaW5lclF1ZXJ5KSB7XHJcblx0XHRcdC8vdG9kbyBlcnJvcnNcclxuXHRcdFx0dGhpcy5jb250YWluZXIgPSAkKGNvbnRhaW5lclF1ZXJ5KTtcclxuXHRcdH1cclxuXHJcblx0XHRVSXRyYW5zaXRpb25zLnByb3RvdHlwZS5lbGVtZW50VHJhbnNpdGlvbiA9IGZ1bmN0aW9uKHRhcmdldEVsZW1lbnRzUXVlcnksXHJcblx0XHRcdHtjc3NFbnVtZXJhYmxlUnVsZSA9ICd3aWR0aCcsIGZyb20gPSAwLCB0byA9ICdhdXRvJywgZGVsYXkgPSAxMDB9KSB7XHJcblx0XHRcdC8vdG9kbyBlcnJvcnNcclxuXHRcdFx0dGhpcy5jb250YWluZXIubW91c2VlbnRlcihcclxuXHRcdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHR2YXIgdGFyZ2V0RWxlbWVudHMgPSAkKHRoaXMpLmZpbmQodGFyZ2V0RWxlbWVudHNRdWVyeSksXHJcblx0XHRcdFx0XHRcdHRhcmdldEVsZW1lbnRzRmluaXNoU3RhdGU7XHJcblxyXG5cdFx0XHRcdFx0dGFyZ2V0RWxlbWVudHMuY3NzKGNzc0VudW1lcmFibGVSdWxlLCB0byk7XHJcblx0XHRcdFx0XHR0YXJnZXRFbGVtZW50c0ZpbmlzaFN0YXRlID0gdGFyZ2V0RWxlbWVudHMuY3NzKGNzc0VudW1lcmFibGVSdWxlKTtcclxuXHRcdFx0XHRcdHRhcmdldEVsZW1lbnRzLmNzcyhjc3NFbnVtZXJhYmxlUnVsZSwgZnJvbSk7XHJcblxyXG5cdFx0XHRcdFx0bGV0IGFuaW1hdGVPcHRpb25zID0ge307XHJcblx0XHRcdFx0XHRhbmltYXRlT3B0aW9uc1tjc3NFbnVtZXJhYmxlUnVsZV0gPSB0YXJnZXRFbGVtZW50c0ZpbmlzaFN0YXRlO1xyXG5cclxuXHRcdFx0XHRcdHRhcmdldEVsZW1lbnRzLmFuaW1hdGUoYW5pbWF0ZU9wdGlvbnMsIGRlbGF5KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIEhlYWRlclRyYW5zaXRpb25zKGhlYWRlclF1ZXJ5LCBjb250YWluZXJRdWVyeSkge1xyXG5cdFx0XHR0aGlzLmhlYWRlciA9ICQoaGVhZGVyUXVlcnkpO1xyXG5cdFx0XHRVSXRyYW5zaXRpb25zLmNhbGwodGhpcywgY29udGFpbmVyUXVlcnkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdEhlYWRlclRyYW5zaXRpb25zLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVUl0cmFuc2l0aW9ucy5wcm90b3R5cGUpO1xyXG5cdFx0SGVhZGVyVHJhbnNpdGlvbnMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gSGVhZGVyVHJhbnNpdGlvbnM7XHJcblxyXG5cdFx0SGVhZGVyVHJhbnNpdGlvbnMucHJvdG90eXBlLmZpeEhlYWRlckVsZW1lbnQgPSBmdW5jdGlvbihcclxuXHRcdFx0X2ZpeEVsZW1lbnQsIGZpeENsYXNzTmFtZSwgdW5maXhDbGFzc05hbWUsIG9wdGlvbnMpIHtcclxuXHRcdFx0bGV0IHNlbGYgPSB0aGlzO1xyXG5cdFx0XHRsZXQgZml4RWxlbWVudCA9ICQoX2ZpeEVsZW1lbnQpO1xyXG5cclxuXHRcdFx0ZnVuY3Rpb24gb25XaWR0aENoYW5nZUhhbmRsZXIoKSB7XHJcblx0XHRcdFx0bGV0IHRpbWVyO1xyXG5cclxuXHRcdFx0XHRmdW5jdGlvbiBmaXhVbmZpeE1lbnVPblNjcm9sbCgpIHtcclxuXHRcdFx0XHRcdGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiBvcHRpb25zLm9uTWluU2Nyb2xsdG9wKSB7XHJcblx0XHRcdFx0XHRcdGZpeEVsZW1lbnQuYWRkQ2xhc3MoZml4Q2xhc3NOYW1lKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdGZpeEVsZW1lbnQucmVtb3ZlQ2xhc3MoZml4Q2xhc3NOYW1lKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR0aW1lciA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCBvcHRpb25zLm9uTWF4V2luZG93V2lkdGgpIHtcclxuXHRcdFx0XHRcdGZpeFVuZml4TWVudU9uU2Nyb2xsKCk7XHJcblx0XHRcdFx0XHRzZWxmLmhlYWRlci5hZGRDbGFzcyh1bmZpeENsYXNzTmFtZSk7XHJcblxyXG5cdFx0XHRcdFx0JCh3aW5kb3cpLm9mZihcInNjcm9sbFwiKTtcclxuXHRcdFx0XHRcdCQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdGlmICghdGltZXIpIHtcclxuXHRcdFx0XHRcdFx0XHR0aW1lciA9ICR0aW1lb3V0KGZpeFVuZml4TWVudU9uU2Nyb2xsLCAxNTApO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0c2VsZi5oZWFkZXIucmVtb3ZlQ2xhc3ModW5maXhDbGFzc05hbWUpO1xyXG5cdFx0XHRcdFx0Zml4RWxlbWVudC5yZW1vdmVDbGFzcyhmaXhDbGFzc05hbWUpO1xyXG5cdFx0XHRcdFx0JCh3aW5kb3cpLm9mZihcInNjcm9sbFwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG9uV2lkdGhDaGFuZ2VIYW5kbGVyKCk7XHJcblx0XHRcdCQod2luZG93KS5vbigncmVzaXplJywgb25XaWR0aENoYW5nZUhhbmRsZXIpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gSGVhZGVyVHJhbnNpdGlvbnNcclxuXHJcblx0fV0pOyIsImFuZ3VsYXIubW9kdWxlKCdhaG90ZWxBcHAnKVxyXG5cclxuXHQuZGlyZWN0aXZlKCdhaHRsU3Rpa3lIZWFkZXInLCBbJ0hlYWRlclRyYW5zaXRpb25zU2VydmljZScsIGZ1bmN0aW9uKEhlYWRlclRyYW5zaXRpb25zU2VydmljZSkge1xyXG5cdFx0XCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5cdFx0ZnVuY3Rpb24gbGluaygpIHtcclxuXHRcdFx0bGV0IGhlYWRlciA9IG5ldyBIZWFkZXJUcmFuc2l0aW9uc1NlcnZpY2UoJy5sLWhlYWRlcicsICcubmF2X19pdGVtLWNvbnRhaW5lcicpO1xyXG5cclxuXHRcdFx0aGVhZGVyLmVsZW1lbnRUcmFuc2l0aW9uKFxyXG5cdFx0XHRcdCcuc3ViLW5hdicsIHtcclxuXHRcdFx0XHRcdGNzc0VudW1lcmFibGVSdWxlOiAnaGVpZ2h0JyxcclxuXHRcdFx0XHRcdGRlbGF5OiAzMDBcclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblxyXG5cdFx0XHRoZWFkZXIuZml4SGVhZGVyRWxlbWVudChcclxuXHRcdFx0XHRcdCcubmF2JyxcclxuXHRcdFx0XHRcdCdqc19uYXYtLWZpeGVkJyxcclxuXHRcdFx0XHRcdCdqc19sLWhlYWRlci0tcmVsYXRpdmUnLFxyXG5cdFx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0XHRvbk1pblNjcm9sbHRvcDogODgsXHJcblx0XHRcdFx0XHRcdG9uTWF4V2luZG93V2lkdGg6IDg1MFxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdClcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRyZXN0cmljdDogXCJBXCIsXHJcblx0XHRcdHNjb3BlOiB7fSxcclxuXHRcdFx0bGluazogbGlua1xyXG5cdFx0fVxyXG5cdH1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnYWhvdGVsQXBwJylcclxuXHJcblx0LmRpcmVjdGl2ZSgnYWh0bFNsaWRlcicsIFsnU2xpZGVyU2VydmljZScsIGZ1bmN0aW9uKFNsaWRlclNlcnZpY2UpIHtcclxuXHRcdFwidXNlIHN0cmljdFwiO1xyXG5cclxuXHRcdGZ1bmN0aW9uIGFodGxTbGlkZXJDb250cm9sbGVyKCkge1xyXG5cdFx0XHRsZXQgaW1hZ2VMaXN0ID0gW1xyXG5cdFx0XHRcdCdhc3NldHMvaW1hZ2VzL3NsaWRlci9zbGlkZXIxLmpwZycsXHJcblx0XHRcdFx0J2Fzc2V0cy9pbWFnZXMvc2xpZGVyL3NsaWRlcjIuanBnJyxcclxuXHRcdFx0XHQnYXNzZXRzL2ltYWdlcy9zbGlkZXIvc2xpZGVyMy5qcGcnXHJcblx0XHRcdF07XHJcblxyXG5cdFx0XHR0aGlzLnNsaWRlciA9IG5ldyBTbGlkZXJTZXJ2aWNlKGltYWdlTGlzdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzdHJpY3Q6ICdFQScsXHJcblx0XHRcdHNjb3BlOiB7fSxcclxuXHRcdFx0Y29udHJvbGxlcjogYWh0bFNsaWRlckNvbnRyb2xsZXIsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ3NsaWRlcicsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnYXBwL3RlbXBsYXRlcy9oZWFkZXIvc2xpZGVyL3NsaWRlci5odG1sJ1xyXG5cdFx0fVxyXG5cdH1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnYWhvdGVsQXBwJylcclxuXHQuc2VydmljZSgnU2xpZGVyU2VydmljZScsIFsnUHJlbG9hZEltYWdlcycsIGZ1bmN0aW9uKFByZWxvYWRJbWFnZXMpIHtcclxuXHRcdFwidXNlIHN0cmljdFwiO1xyXG5cclxuXHRcdFx0ZnVuY3Rpb24gU2xpZGVyKHNsaWRlckltYWdlTGlzdCkge1xyXG5cdFx0XHRcdFByZWxvYWRJbWFnZXMuY2FsbCh0aGlzLCBzbGlkZXJJbWFnZUxpc3QpO1xyXG5cdFx0XHRcdHRoaXMuX2N1cnJlbnRTbGlkZVNyYyA9IDA7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdFNsaWRlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFByZWxvYWRJbWFnZXMucHJvdG90eXBlKTtcclxuXHRcdFx0U2xpZGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNsaWRlcjtcclxuXHJcblx0XHRcdFNsaWRlci5wcm90b3R5cGUuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ltYWdlU3JjTGlzdFt0aGlzLl9jdXJyZW50U2xpZGVTcmNdXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRTbGlkZXIucHJvdG90eXBlLmdldE5leHRTbGlkZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdCh0aGlzLl9jdXJyZW50U2xpZGVTcmMgPT09IHRoaXMuX2ltYWdlU3JjTGlzdC5sZW5ndGgpID8gdGhpcy5fY3VycmVudFNsaWRlU3JjID0gMCA6IHRoaXMuX2N1cnJlbnRTbGlkZVNyYysrXHJcblxyXG5cdFx0XHRcdHRoaXMuZ2V0Q3VycmVudFNsaWRlKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRTbGlkZXIucHJvdG90eXBlLmdldFByZXZTbGlkZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdCh0aGlzLl9jdXJyZW50U2xpZGVTcmMgPT09IDApID8gdGhpcy5fY3VycmVudFNsaWRlU3JjID0gdGhpcy5faW1hZ2VTcmNMaXN0Lmxlbmd0aCAtIDEgOiB0aGlzLl9jdXJyZW50U2xpZGVTcmMtLVxyXG5cclxuXHRcdFx0XHR0aGlzLmdldEN1cnJlbnRTbGlkZSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0cmV0dXJuIFNsaWRlclxyXG5cdH1dKTsiXX0=
